= [Mac][Windows][Emacs] Shellの設定

Windows gnupackでmulti-termを使おうとして試行錯誤．WindowsでShellを完全に使おうと思うと，fakecygpty.exeなるものが必要らしい．調べてみると，cソースがあるので，これを自分でコンパイルして使うようだ．http://www.meadowy.org/meadow/browser/trunk/nt/fakecygpty.cからfakecygpty.cをダウンロードし，Cygwin上で，
	$ gcc -o fakecygpty.exe fakecygpty.c
としたところ，エラーが大量に吐かれる．どうも#includeされてるファイルが存在しないと怒られてるみたい．いろいろ調べたがこれ以上の解決策は見つからず，断念．

gnupackでshell-modeはどうやら使えるっぽいので，とりあえずはこれで我慢する．
ただし，文字化けが起こっていたので，'shell-mode-hookに'set-buffer-process-coding-systemを追加し，解決．

さてMacだが，こちらはmulti-termが正常に動いている．以前に'term-exec-hookに'set-buffer-process-coding-systemを追加し文字化けを解消してある．
デフォルトではbashを使う設定になっていたが，Macにはzshが入っているのでzshを使ってみた．が，multi-termを起動すると，
	4mKubo-MBPR% 
と表示され，余計な"4m"がある…．今のところ動作に支障はないが，解決すべきだろう．調べてみると，http://sakito.jp/emacs/emacsshell.html#id11に原因と対策が書かれているので，後で試してみる．
[2013-07-31]. [2013-07-31]:- Mac emacs zsh bug-fix
[追記 2013-07-31]：http://sakito.jp/emacs/emacsshell.html#id11のとおり，
      % tic -o ~/.terminfo /Applications/Emacs.app/Contents/Resources/etc/e/eterm-color.ti
として.terminfoを生成したら"4m"は消えた．

今の段階では，Windowsにzshは入っていなかったので，init.elにはshellコマンドに優先順位を付け，最初に見つかったものを利用するという設定に書き換えた．

[2013-07-31 01:01] 

= [Mac][Windows][Emacs] init.el統合

今までgnupack限定の設定等があったので，WindowsとMacで異なるinit.elを使い，共通設定はinit.elからinit-common.elを読み込んでいた．Dropboxでinitファイルは同期させていたが，この方法だと少々ディレクトリ構成が煩雑だった．

init.elを共通にして，'window-systemでWindowsのみgnupack専用の設定を読みこませればいいことに気づく．そうすれば，.emacs.dを単純にDropboxへのシンボリックリンクにするだけで済む．

なぜ思いつかなかったのか…

[2013-07-31 01:26] 

= [Windows][Emacs] zsh for Windows

[2013-08-01]. [2013-07-31]:- Set zsh as login shell in Windows mintty

Windowsでzshを利用可能にする．
http://futurismo.biz/archives/1363とかhttp://qiita.com/PSP_T/items/2c51a33a3ca82999bea2を参考に，minttyのbashで
	$ apt-cyg install zsh
としてインストール．init.elを設定したら，emacs上からはshellでzshが起動するようになった．minttyは依然としてbashがデフォルトになっている．どうやら$SHELLが"/bin/bash"になっているのが原因っぽい．http://yanother.blogspot.jp/2011/02/zsh.htmlに解決方法がありそう．

[2013-08-01追記]
$SHELLを設定しても状況は変わらなかった．なので$SHELLは消去．

ref: http://yanother.blogspot.jp/2011/02/zsh.html

まずログインシェルの変更．/etc/passwdの/bin/bashを/bin/zshに直接書き換えた．本来のUnix環境ならchshするらしい．

Cygwin.batを書き換える方法でminttyを起動したところ，めでたくzshがデフォルトで使えるようになった．今までgnupackルートに入っていたmintty.exeを用いていたが，これ経由でzshをデフォルトにする方法はよくわからなかった．代わりにCygwinの中にあるCygwin.batを経由し，Cygwinのminttyを使いログインシェルをzshにして起動する方法で解決．Cygwin.batの該当部分はこんな感じ．
	C:
	chdir C:\gnupack_devel-11.00\app\cygwin\cygwin\bin
	sh -c "/usr/bin/mintty - &"

[2013-07-31 10:28] 

